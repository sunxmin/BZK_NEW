# 将BZKQuerySystem项目部署到IIS的详细指南

## 1. 使用Visual Studio发布项目

### 1.1 打开项目
1. 在Visual Studio中打开解决方案文件`BZKQuerySystem.sln`
2. 确保解决方案配置设置为"Release"（在顶部工具栏选择Release）

### 1.2 发布项目
1. 在解决方案资源管理器中右键点击`BZKQuerySystem.Web`项目
2. 选择"发布..."
3. 在弹出的发布对话框中：
   - 选择"文件夹"作为发布目标
   - 指定一个发布路径（例如`D:\Publish\BZKQuerySystem`）
   - 点击"配置"按钮，确保以下设置：
     - 配置：Release
     - 目标框架：确认是您当前使用的框架（如.NET 6.0）
     - 部署模式：框架依赖（Frameworkdependent）
     - 目标运行时：win-x64
   - 点击"保存"
4. 点击"发布"按钮开始发布过程
5. 发布完成后，所有必要文件将在您指定的发布文件夹中生成

## 2. 部署到IIS

### 2.1 IIS服务器准备
1. 确保服务器已安装以下内容：
   - IIS (Internet Information Services)
   - ASP.NET Core 模块（可通过安装[.NET Core 托管捆绑包](https://dotnet.microsoft.com/download/dotnet/current/runtime)获得）
   - 已安装与应用程序相同版本的.NET运行时

### 2.2 创建IIS网站
1. 打开IIS管理器
2. 在"连接"面板中，右键点击"网站"，选择"添加网站..."
3. 在"添加网站"对话框中：
   - 网站名称：输入一个有意义的名称（例如"BZKQuerySystem"）
   - 物理路径：选择发布文件所在的文件夹路径
   - 绑定信息：设置IP地址、端口和主机名
4. 点击"确定"创建网站

### 2.3 配置应用程序池
1. 在IIS管理器中，点击"应用程序池"
2. 找到新创建网站使用的应用程序池
3. 右键点击并选择"基本设置..."
4. 确保：
   - .NET CLR版本：设置为"无托管代码"（因为ASP.NET Core应用是自托管的）
   - 托管管道模式：集成
   - 标识：选择适当的运行身份（默认为ApplicationPoolIdentity）
5. 点击"确定"保存设置

### 2.4 配置应用程序权限
1. 找到您发布的网站文件夹
2. 右键点击该文件夹，选择"属性"
3. 切换到"安全"选项卡
4. 确保IIS_IUSRS组（或您的应用程序池身份）具有读取和执行权限
5. 点击"确定"保存设置

### 2.5 检查并更新数据库连接字符串
1. 在发布文件夹中，找到`appsettings.json`（或`appsettings.Production.json`）
2. 确保数据库连接字符串指向正确的数据库服务器和数据库
3. 根据需要更新连接字符串中的服务器名称、数据库名称、用户名和密码

### 2.6 启动网站
1. 在IIS管理器中，选择您的网站
2. 在右侧的"管理网站"面板中，点击"启动"
3. 打开浏览器，导航到您配置的URL，确认网站正常运行

## 3. 故障排除

### 3.1 常见问题
1. **500.19错误**：通常是由于配置问题或权限不足。确保已安装ASP.NET Core模块。
2. **500.30错误**：ANCM启动进程失败。检查应用程序池配置和日志。
3. **404错误**：确保IIS重写规则正确，且web.config存在。

### 3.2 日志检查
1. 检查Windows事件日志（事件查看器）中的应用程序日志
2. 检查应用程序自身的日志（通常位于发布文件夹的logs目录中）

### 3.3 IIS配置检查
1. 确保已安装正确版本的.NET运行时
2. 验证web.config文件中的配置正确，特别是：
   - processPath指向dotnet.exe
   - arguments包含应用程序dll的正确路径

## 4. 附加说明

### 4.1 更新部署
更新应用程序时，只需重复发布过程，然后将新文件复制到IIS网站文件夹即可。建议在更新前备份网站文件夹和数据库。

### 4.2 自动化部署
如果需要频繁部署，可以考虑设置自动化部署流程，例如使用CI/CD工具如Azure DevOps、Jenkins或GitHub Actions。

### 4.3 部署注意事项
1. 确保服务器环境与开发环境的.NET版本一致
2. 部署前备份数据库
3. 部署后验证所有功能是否正常工作
4. 考虑设置监控系统来跟踪应用程序性能和错误 


