# BZK查询系统 - 详细测试用例文档

**文档版本**: v1.0  
**创建日期**: 2025年1月3日  
**文档类型**: 测试用例文档  
**适用版本**: BZK查询系统 v2.0+  

## ? 测试用例概述

### 测试用例编号规范
- **TC-模块-编号-描述**
- 模块代码：LOGIN(登录)、QUERY(查询)、EXPORT(导出)、ADMIN(管理)、PERF(性能)、SEC(安全)

### 测试优先级
- **P1-高优先级**: 核心功能，系统无法工作
- **P2-中优先级**: 重要功能，影响用户体验
- **P3-低优先级**: 辅助功能，可以延后修复

## ? 用户认证模块测试用例

### TC-LOGIN-001: 有效用户登录
**优先级**: P1  
**前置条件**: 
- 系统正常运行
- 存在有效用户账号 testuser01/Password123!

**测试步骤**:
1. 打开系统登录页面 `http://localhost:5000/Account/Login`
2. 在用户名输入框输入 `testuser01`
3. 在密码输入框输入 `Password123!`
4. 点击"登录"按钮

**预期结果**:
- 页面跳转到主页面 `/Home`
- 显示用户欢迎信息
- 页面顶部显示用户名和注销链接
- ? **需要实际验证**: 实际跳转时间和页面加载

**验证方法**:
```javascript
// 浏览器控制台验证
console.log(window.location.pathname); // 应该是 "/Home"
console.log(document.querySelector('.user-info').textContent); // 应该包含用户名
```

---

### TC-LOGIN-002: 无效用户名登录
**优先级**: P1  
**前置条件**: 系统正常运行

**测试步骤**:
1. 打开系统登录页面
2. 在用户名输入框输入 `invalid-user`
3. 在密码输入框输入 `Password123!`
4. 点击"登录"按钮

**预期结果**:
- 页面不跳转，停留在登录页面
- 显示错误提示信息："用户名或密码错误"
- 用户名和密码输入框清空
- ? **需要实际验证**: 错误信息的具体内容和显示方式

---

### TC-LOGIN-003: 错误密码登录
**优先级**: P1  
**前置条件**: 系统正常运行

**测试步骤**:
1. 打开系统登录页面
2. 在用户名输入框输入 `testuser01`
3. 在密码输入框输入 `wrongpassword`
4. 点击"登录"按钮

**预期结果**:
- 页面不跳转，停留在登录页面
- 显示错误提示信息："用户名或密码错误"
- 密码输入框清空
- ? **需要实际验证**: 密码错误计数和锁定机制

---

### TC-LOGIN-004: 空用户名登录
**优先级**: P2  
**前置条件**: 系统正常运行

**测试步骤**:
1. 打开系统登录页面
2. 用户名输入框保持为空
3. 在密码输入框输入 `Password123!`
4. 点击"登录"按钮

**预期结果**:
- 用户名输入框显示验证错误："请输入用户名"
- 登录按钮无法点击或点击无效
- ? **需要实际验证**: 前端验证机制

---

### TC-LOGIN-005: 会话超时测试
**优先级**: P2  
**前置条件**: 用户已登录系统

**测试步骤**:
1. 正常登录系统
2. 等待会话超时（默认30分钟）或手动清除会话
3. 尝试访问需要认证的页面
4. 观察系统行为

**预期结果**:
- 自动跳转到登录页面
- 显示会话超时提示信息
- ? **需要实际验证**: 会话超时时间和处理机制

## ? 查询功能模块测试用例

### TC-QUERY-001: 简单单表查询
**优先级**: P1  
**前置条件**: 
- 用户已登录
- 具有Patient表的查询权限

**测试步骤**:
1. 进入查询构建器页面 `/QueryBuilder`
2. 在表选择器中选择"Patient"表
3. 选择字段：PatientId、Name、Gender
4. 添加条件：CreateDate >= '2024-01-01'
5. 点击"执行查询"按钮

**预期结果**:
- 查询执行成功，返回HTTP 200状态
- 结果表格显示选中的字段数据
- 显示查询执行时间和记录数量
- 数据按CreateDate降序排列
- ? **需要实际验证**: 查询执行时间 < 5秒，记录数量准确性

**SQL验证**:
```sql
-- 预期生成的SQL
SELECT Patient.PatientId AS [患者ID], 
       Patient.Name AS [姓名], 
       Patient.Gender AS [性别]
FROM Patient 
WHERE Patient.CreateDate >= '2024-01-01'
ORDER BY Patient.CreateDate DESC
```

---

### TC-QUERY-002: 复杂多表关联查询
**优先级**: P1  
**前置条件**: 
- 用户已登录
- 具有Patient、Visit、Diagnosis表的查询权限

**测试步骤**:
1. 进入查询构建器页面
2. 选择表：Patient、Visit、Diagnosis
3. 配置关联关系：
   - Patient.PatientId = Visit.PatientId (INNER JOIN)
   - Visit.VisitId = Diagnosis.VisitId (LEFT JOIN)
4. 选择字段：Patient.Name、Visit.VisitDate、Diagnosis.DiagnosisName
5. 添加条件：Visit.VisitDate >= '2024-01-01' AND Patient.Age >= 18
6. 点击"执行查询"按钮

**预期结果**:
- 查询执行成功，返回关联数据
- 显示正确的多表关联结果
- 字段别名正确显示
- ? **需要实际验证**: 复杂查询执行时间 < 10秒，关联结果准确性

---

### TC-QUERY-003: 查询条件测试
**优先级**: P1  
**前置条件**: 用户已登录并进入查询构建器

**测试数据**:
| 条件类型 | 字段 | 操作符 | 值 | 预期结果 |
|----------|------|--------|-----|----------|
| 等于 | Patient.Gender | = | '男' | 返回男性患者 |
| 不等于 | Patient.Gender | != | '男' | 返回非男性患者 |
| 大于 | Patient.Age | > | 30 | 返回年龄>30的患者 |
| 范围 | Patient.CreateDate | BETWEEN | '2024-01-01' AND '2024-12-31' | 返回2024年创建的患者 |
| 包含 | Patient.Name | LIKE | '%张%' | 返回姓名包含"张"的患者 |
| 空值 | Patient.Phone | IS NULL | - | 返回电话为空的患者 |

**测试步骤**:
1. 对每种条件类型分别进行测试
2. 验证生成的SQL语句正确性
3. 验证查询结果的准确性
4. 测试复合条件（AND/OR组合）

**? 需要实际验证**:
- 各种操作符的查询结果准确性
- 复合条件的逻辑正确性
- 中文模糊查询的支持程度

---

### TC-QUERY-004: 查询结果分页
**优先级**: P2  
**前置条件**: 用户已登录，存在大量测试数据

**测试步骤**:
1. 执行一个返回大量结果的查询（>1000条）
2. 观察分页控件的显示
3. 点击"下一页"按钮
4. 跳转到指定页码
5. 修改每页显示数量

**预期结果**:
- 默认每页显示50条记录
- 分页控件正确显示总页数和当前页
- 页面跳转功能正常
- ? **需要实际验证**: 大数据量下的分页性能

---

### TC-QUERY-005: 查询保存和加载
**优先级**: P2  
**前置条件**: 用户已登录，已构建查询

**测试步骤**:
1. 构建一个复杂查询
2. 点击"保存查询"按钮
3. 输入查询名称："测试查询_患者统计"
4. 保存成功后清空当前查询
5. 从"我的查询"列表中加载保存的查询
6. 验证查询配置是否正确恢复

**预期结果**:
- 查询保存成功，显示成功提示
- 查询列表中显示保存的查询
- 加载的查询配置与原配置一致
- ? **需要实际验证**: 复杂查询的保存和恢复完整性

## ? 数据导出模块测试用例

### TC-EXPORT-001: Excel格式导出
**优先级**: P1  
**前置条件**: 
- 用户已登录并具有导出权限
- 已执行查询并有结果数据

**测试步骤**:
1. 执行查询获得100条结果数据
2. 点击"导出Excel"按钮
3. 等待导出完成
4. 下载并打开Excel文件

**预期结果**:
- 导出文件成功生成
- 文件名格式：`查询结果_YYYYMMDD_HHMMSS.xlsx`
- Excel文件包含完整的查询结果
- 表头为字段别名（中文）
- 数据格式正确，无乱码
- ? **需要实际验证**: 
  - 100条数据导出时间 < 10秒
  - 大数据量（10000条）导出性能
  - 文件大小合理性

**Excel文件验证**:
```
预期文件结构:
- 第一行：字段标题（中文别名）
- 数据行：查询结果数据
- 格式：日期格式正确，数字格式正确
- 编码：支持中文，无乱码
```

---

### TC-EXPORT-002: PDF格式导出 ? **功能已实现**
**优先级**: P1  
**前置条件**: 同TC-EXPORT-001

**测试步骤**:
1. 执行查询获得500条结果数据
2. 点击"导出PDF"按钮
3. 设置PDF选项：
   - 标题："患者查询报告"
   - 方向：自适应
   - 每页行数：50行
4. 等待导出完成
5. 下载并打开PDF文件

**预期结果**:
- PDF文件成功生成
- 文件包含设置的标题和元数据
- 中文字体正确显示（宋体或微软雅黑）
- 表格布局美观，自适应页面宽度
- 页脚显示页码和生成时间
- 数据分页正确（每页最多50行）
- ? **需要实际验证**:
  - 500条数据导出时间 < 20秒
  - 中文字体显示效果
  - 横向布局的表格显示
  - 大数据量的内存使用情况

**PDF文件验证检查清单**:
```
□ 文件头正确（%PDF-1.4或更高版本）
□ 中文字体不出现方块或乱码
□ 表格对齐且易读
□ 页面边距合适
□ 页码显示正确
□ 元数据包含标题、作者、创建时间
```

---

### TC-EXPORT-003: CSV格式导出
**优先级**: P1  
**前置条件**: 同TC-EXPORT-001

**测试步骤**:
1. 执行查询获得1000条结果数据
2. 点击"导出CSV"按钮
3. 选择编码格式：UTF-8 BOM
4. 等待导出完成
5. 下载CSV文件并用Excel打开

**预期结果**:
- CSV文件成功生成
- 文件编码为UTF-8 BOM，支持中文
- 第一行为字段标题
- 数据正确分隔，无格式错误
- 特殊字符（逗号、引号）正确转义
- ? **需要实际验证**:
  - 1000条数据导出时间 < 5秒
  - 中文字符在Excel中正确显示
  - 特殊字符处理正确性

---

### TC-EXPORT-004: 大数据量导出测试
**优先级**: P2  
**前置条件**: 
- 数据库中有大量测试数据（>10000条）
- 用户具有大数据导出权限

**测试数据量**:
| 数据量 | Excel预期时间 | PDF预期时间 | CSV预期时间 | 内存使用 |
|--------|---------------|-------------|-------------|----------|
| 1000条 | <8秒 | <12秒 | <4秒 | <100MB |
| 5000条 | <20秒 | <30秒 | <10秒 | <300MB |
| 10000条 | <40秒 | <60秒 | <20秒 | <500MB |

**测试步骤**:
1. 分别测试不同数据量的导出
2. 监控服务器资源使用情况
3. 验证导出文件的完整性
4. 测试并发导出的影响

**? 需要实际验证**:
- 各种数据量下的实际导出时间
- 内存使用峰值和释放情况
- 导出过程中系统响应性
- 文件完整性验证

---

### TC-EXPORT-005: 导出权限控制测试
**优先级**: P1  
**前置条件**: 
- 准备有导出权限和无导出权限的用户账号

**测试步骤**:
1. 使用无导出权限用户登录
2. 执行查询获得结果
3. 尝试点击导出按钮
4. 使用有导出权限用户重复测试

**预期结果**:
- 无权限用户：导出按钮不可见或不可点击
- 无权限用户：直接访问导出API返回403错误
- 有权限用户：导出功能正常工作
- ? **需要实际验证**: 权限控制的前端和后端实现

---

### TC-EXPORT-006: 导出速率限制测试 ? **速率限制已实现**
**优先级**: P2  
**前置条件**: 用户已登录并具有导出权限

**测试步骤**:
1. 在1小时内连续发起11次导出请求
2. 观察第11次请求的响应
3. 等待限制时间窗口重置
4. 再次尝试导出

**预期结果**:
- 前10次导出请求正常处理
- 第11次请求返回429状态码（速率限制）
- 错误信息提示："导出频率过高，请稍后再试"
- 时间窗口重置后可以再次导出
- ? **需要实际验证**: 速率限制的触发和重置机制

## ? 性能测试用例

### TC-PERF-001: 页面响应时间测试
**优先级**: P1  
**测试工具**: 浏览器开发者工具或JMeter

**测试场景**:
| 页面 | 设计目标 | 测试条件 | 验证指标 |
|------|----------|----------|----------|
| 登录页面 | <500ms | 冷启动 | DOMContentLoaded时间 |
| 主页面 | <1000ms | 已登录用户 | 完全加载时间 |
| 查询页面 | <1000ms | 包含表结构加载 | 交互可用时间 |

**测试步骤**:
1. 清除浏览器缓存
2. 使用浏览器开发者工具记录网络性能
3. 访问目标页面
4. 记录关键性能指标
5. 重复测试10次取平均值

**? 需要实际验证**:
- 实际页面加载时间
- 网络请求数量和大小
- 阻塞资源识别
- 首屏渲染时间

---

### TC-PERF-002: 查询执行性能测试
**优先级**: P1  
**测试工具**: SQL Server Profiler + JMeter

**测试场景**:
| 查询类型 | 数据量 | 设计目标 | 并发数 |
|----------|--------|----------|--------|
| 简单单表 | 1000条 | <500ms | 10用户 |
| 复杂多表 | 5000条 | <2000ms | 5用户 |
| 聚合统计 | 10000条 | <3000ms | 3用户 |

**测试步骤**:
1. 准备标准测试数据集
2. 设计标准查询模板
3. 使用JMeter模拟并发查询
4. 监控数据库性能指标
5. 记录响应时间分布

**? 需要实际验证**:
- 不同复杂度查询的实际执行时间
- 数据库CPU和内存使用率
- 并发查询对性能的影响
- 查询计划和索引使用情况

---

### TC-PERF-003: 并发用户性能测试
**优先级**: P1  
**测试工具**: JMeter

**测试计划**:
```yaml
测试阶段1: 基准测试
  - 用户数: 1
  - 持续时间: 10分钟
  - 操作: 混合操作（登录、查询、导出）

测试阶段2: 负载测试
  - 用户数: 10, 30, 50, 100
  - 加压时间: 5分钟
  - 持续时间: 30分钟

测试阶段3: 压力测试
  - 用户数: 120, 150, 180, 200
  - 加压时间: 10分钟
  - 持续时间: 20分钟
```

**关键指标**:
- 平均响应时间
- 95%响应时间
- 错误率
- 吞吐量（TPS）
- 系统资源使用率

**? 需要实际验证**:
- 实际支持的最大并发用户数
- 系统瓶颈点识别
- 性能拐点分析
- 稳定性验证

## ?? 安全测试用例

### TC-SEC-001: SQL注入安全测试
**优先级**: P1  
**测试工具**: 手动测试 + OWASP ZAP

**测试输入**:
```sql
-- 测试用例1: 基础SQL注入
'; DROP TABLE Patient; --

-- 测试用例2: Union注入
' UNION SELECT username, password FROM Users; --

-- 测试用例3: 布尔盲注
' AND 1=1; --
' AND 1=2; --

-- 测试用例4: 时间盲注
'; WAITFOR DELAY '00:00:05'; --
```

**测试步骤**:
1. 在查询条件输入框中输入恶意SQL代码
2. 提交查询请求
3. 观察系统响应和错误信息
4. 检查数据库是否受到影响

**预期结果**:
- 所有恶意输入被正确过滤或参数化
- 不返回敏感错误信息
- 数据库结构不被泄露
- ? **需要实际验证**: 参数化查询的实现完整性

---

### TC-SEC-002: XSS攻击防护测试
**优先级**: P1  
**测试工具**: 手动测试

**测试输入**:
```html
<!-- 测试用例1: 基础XSS -->
<script>alert('XSS')</script>

<!-- 测试用例2: 事件XSS -->
<img src=x onerror=alert('XSS')>

<!-- 测试用例3: URL编码XSS -->
%3Cscript%3Ealert('XSS')%3C/script%3E
```

**测试位置**:
- 查询条件输入框
- 字段别名输入
- 查询名称保存
- 用户名输入

**预期结果**:
- 恶意脚本不被执行
- 输出内容被正确编码
- 不影响正常功能使用
- ? **需要实际验证**: 输出编码的完整性

---

### TC-SEC-003: 越权访问测试
**优先级**: P1  
**测试前置**: 准备不同权限级别的用户账号

**测试场景**:
1. **表权限测试**:
   - 用户A只有Patient表权限
   - 尝试访问Visit表数据
   - 验证是否被正确拒绝

2. **功能权限测试**:
   - 用户B没有导出权限
   - 尝试直接访问导出API
   - 验证是否返回403错误

3. **数据权限测试**:
   - 用户C只能查看自己科室数据
   - 尝试查询其他科室数据
   - 验证数据隔离效果

**? 需要实际验证**:
- 权限检查的前端和后端实现
- 直接API访问的权限控制
- 数据级权限的过滤效果

---

### TC-SEC-004: 会话安全测试
**优先级**: P2  
**测试工具**: 浏览器开发者工具

**测试项目**:
1. **Cookie安全性**:
   - 检查HttpOnly标志
   - 检查Secure标志
   - 检查SameSite设置

2. **会话固定**:
   - 登录前后SessionID是否变化
   - 注销后SessionID是否失效

3. **会话超时**:
   - 验证超时机制
   - 验证自动注销功能

**? 需要实际验证**:
- Cookie安全配置
- 会话管理机制
- 超时处理的准确性

## ? 兼容性测试用例

### TC-COMPAT-001: 浏览器兼容性测试
**优先级**: P2  
**测试环境**:

| 浏览器 | 版本 | 操作系统 | 核心功能 | 导出功能 | UI显示 |
|--------|------|----------|----------|----------|--------|
| Chrome | 90+ | Windows 10 | ? 测试 | ? 测试 | ? 测试 |
| Edge | 90+ | Windows 10 | ? 测试 | ? 测试 | ? 测试 |
| Firefox | 88+ | Windows 10 | ? 测试 | ? 测试 | ? 测试 |
| Safari | 14+ | macOS | ? 测试 | ? 测试 | ? 测试 |

**测试内容**:
1. 登录功能
2. 查询构建器操作
3. 数据导出功能
4. JavaScript功能
5. CSS样式显示

**? 需要实际验证**:
- 跨浏览器的功能一致性
- 性能差异对比
- 特定浏览器的已知问题

---

### TC-COMPAT-002: 屏幕分辨率适配测试
**优先级**: P2  

**测试分辨率**:
```yaml
桌面端:
  - 1920x1080 (Full HD)
  - 1366x768 (笔记本常见)
  - 1440x900 (MacBook)
  - 2560x1440 (2K显示器)

移动端 (如果支持):
  - 375x667 (iPhone 6/7/8)
  - 414x896 (iPhone 11)
  - 768x1024 (iPad)
```

**测试内容**:
- 页面布局适应性
- 表格显示效果
- 按钮和表单元素可用性
- 响应式菜单功能

**? 需要实际验证**:
- 不同分辨率下的用户体验
- 是否需要横向滚动
- 文字和按钮大小适配

## ? 测试执行计划

### 测试阶段安排

**第一阶段：核心功能验证（3天）**
- 执行所有P1级别测试用例
- 验证基本功能可用性
- 修复阻塞性问题

**第二阶段：性能和安全测试（2天）**
- 执行性能测试用例
- 执行安全测试用例
- 分析性能瓶颈

**第三阶段：兼容性和用户体验（2天）**
- 执行兼容性测试
- 用户体验测试
- 文档更新和问题总结

### 测试环境要求

**硬件环境**:
```yaml
测试服务器:
  - CPU: 4核以上
  - 内存: 8GB以上
  - 硬盘: SSD 100GB以上

测试客户端:
  - CPU: 双核以上
  - 内存: 4GB以上
  - 浏览器: 多种版本
```

**软件环境**:
```yaml
服务器端:
  - Windows Server 2019
  - .NET 8.0
  - SQL Server 2019
  - IIS 10.0

测试工具:
  - JMeter 5.5+
  - Selenium WebDriver
  - OWASP ZAP
  - Visual Studio Test Explorer
```

### 测试数据准备

**基础测试数据**:
```sql
-- 用户数据
INSERT INTO Users VALUES 
('testuser01', 'Password123!', '测试用户1'),
('testuser02', 'Password123!', '测试用户2'),
('admin01', 'Admin123!', '管理员');

-- 患者测试数据 (1000条)
-- 就诊测试数据 (5000条)  
-- 诊断测试数据 (10000条)
```

**大数据量测试**:
- 使用数据生成脚本创建50000+条记录
- 确保数据分布合理，覆盖各种查询场景

### 缺陷管理

**缺陷等级定义**:
- **严重**: 系统崩溃、数据丢失、安全漏洞
- **重要**: 核心功能无法使用、性能严重不达标
- **一般**: 功能异常但有替代方案
- **轻微**: UI问题、文档问题

**缺陷跟踪**:
- 使用统一的缺陷管理模板
- 记录重现步骤和环境信息
- 分配责任人和修复时间

---

**文档维护**: 测试工程师  
**创建日期**: 2025年1月3日  
**适用版本**: BZK查询系统 v2.0+  
**下一步**: 安全测试检查清单制定 