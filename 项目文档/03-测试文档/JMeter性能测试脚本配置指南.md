# BZK查询系统 - JMeter性能测试脚本配置指南

**文档版本**: v1.0  
**创建日期**: 2025年1月3日  
**文档类型**: 测试配置指南  
**适用工具**: Apache JMeter 5.5+  

## ? 测试概述

### 测试目标
- 验证系统在不同并发用户数下的性能表现
- 测试关键功能的响应时间
- 确定系统的最大并发处理能力
- 验证速率限制机制的有效性

### 测试环境要求
```yaml
JMeter配置:
  - JMeter版本: 5.5+
  - Java版本: JDK 8+
  - 内存配置: -Xms1g -Xmx4g
  
目标系统:
  - 系统URL: http://localhost:5000 (根据实际情况调整)
  - 测试数据库: 准备测试数据
  - 用户账号: 准备多个测试用户
```

## ? 测试计划配置

### 1. 登录性能测试

#### 测试计划结构
```
BZK性能测试计划
├── 登录测试线程组
│   ├── HTTP Cookie管理器
│   ├── 用户变量配置
│   ├── CSV数据文件配置
│   └── HTTP请求采样器
└── 响应时间监听器
```

#### CSV用户数据文件 (users.csv)
```csv
username,password
testuser01,Password123!
testuser02,Password123!
testuser03,Password123!
testuser04,Password123!
testuser05,Password123!
```

#### 线程组配置
- **线程数**: 10, 50, 100, 120, 180 (分别测试)
- **加压时间**: 60秒
- **持续时间**: 300秒
- **循环次数**: 永远

#### HTTP请求配置
```
请求类型: POST
路径: /Account/Login
参数:
  - Username: ${username}
  - Password: ${password}
  - RememberMe: false
```

### 2. 查询功能性能测试

#### 测试场景设计
```yaml
场景1 - 简单单表查询:
  - 查询类型: 单表
  - 字段数量: 5个
  - 条件数量: 1-2个
  - 预期数据量: 100-1000条

场景2 - 复杂多表查询:
  - 查询类型: 多表关联
  - 表数量: 2-3个
  - 字段数量: 10个
  - 条件数量: 3-5个
  - 预期数据量: 1000-5000条
```

#### 查询请求配置
```json
{
  "method": "POST",
  "path": "/api/query/execute",
  "headers": {
    "Content-Type": "application/json",
    "Authorization": "Bearer ${access_token}"
  },
  "body": {
    "tables": ["Patient", "Visit"],
    "fields": [
      {"table": "Patient", "field": "PatientId", "alias": "患者ID"},
      {"table": "Patient", "field": "Name", "alias": "姓名"},
      {"table": "Visit", "field": "VisitDate", "alias": "就诊日期"}
    ],
    "conditions": [
      {
        "field": "Patient.CreateDate",
        "operator": ">=",
        "value": "2024-01-01"
      }
    ]
  }
}
```

### 3. 数据导出性能测试

#### Excel导出测试
```
请求配置:
  - 方法: POST
  - 路径: /api/export/excel
  - 数据量: 100, 1000, 5000, 10000条
  - 超时设置: 60秒
```

#### PDF导出测试
```
请求配置:
  - 方法: POST
  - 路径: /api/export/pdf
  - 数据量: 100, 1000, 5000, 10000条
  - 超时设置: 90秒
```

#### CSV导出测试
```
请求配置:
  - 方法: POST
  - 路径: /api/export/csv
  - 数据量: 100, 1000, 5000, 10000条
  - 超时设置: 30秒
```

## ? 监听器配置

### 1. 聚合报告监听器
- **配置项**: 启用
- **文件保存**: results/aggregate_report.jtl
- **显示内容**: 所有统计数据

### 2. 响应时间图表
- **配置项**: 启用
- **时间间隔**: 1000ms
- **文件保存**: results/response_times.png

### 3. TPS监听器
- **配置项**: 启用
- **计算间隔**: 1秒
- **文件保存**: results/tps_report.jtl

## ? 高级配置

### 1. 速率限制测试配置

#### 查询速率限制测试
```yaml
线程组配置:
  - 线程数: 1
  - 循环次数: 35次
  - 间隔时间: 1.8秒
目标: 验证第31次查询被拒绝
```

#### 导出速率限制测试
```yaml
线程组配置:
  - 线程数: 1
  - 循环次数: 12次
  - 间隔时间: 5分钟
目标: 验证第11次导出被拒绝
```

### 2. 断言配置

#### 成功响应断言
```
断言类型: 响应断言
应用范围: 主样本
字段测试: 响应代码
模式匹配: 200
```

#### 错误响应断言
```
断言类型: 响应断言
应用范围: 主样本
字段测试: 响应文本
模式匹配: error|Error|错误
```

## ? 测试执行计划

### 阶段1: 基准测试
1. **单用户测试**: 验证基本功能正常
2. **响应时间测试**: 记录各功能的基准响应时间
3. **功能验证**: 确保所有接口正常工作

### 阶段2: 负载测试
1. **10用户并发**: 正常负载测试
2. **50用户并发**: 中等负载测试
3. **100用户并发**: 高负载测试

### 阶段3: 压力测试
1. **120用户并发**: 推荐负载上限测试
2. **180用户并发**: 最大负载测试
3. **200用户并发**: 超限测试

### 阶段4: 专项测试
1. **长时间稳定性测试**: 2小时持续运行
2. **大数据导出测试**: 10000条以上数据
3. **速率限制验证**: 限制机制测试

## ? 结果分析指标

### 关键性能指标
```yaml
响应时间指标:
  - 平均响应时间 (Average)
  - 95%响应时间 (95th Percentile)
  - 99%响应时间 (99th Percentile)
  - 最大响应时间 (Max)

吞吐量指标:
  - 每秒事务数 (TPS)
  - 每秒请求数 (RPS)
  - 每分钟请求数 (RPM)

错误率指标:
  - 错误百分比 (Error %)
  - HTTP错误码分布
  - 超时错误统计
```

### 资源监控
```yaml
服务器监控:
  - CPU使用率
  - 内存使用率
  - 磁盘I/O
  - 网络带宽

数据库监控:
  - 连接池使用情况
  - 查询执行时间
  - 锁等待时间
  - 数据库CPU/内存
```

## ? 注意事项

### 测试前准备
1. **备份数据**: 确保测试数据完整性
2. **环境隔离**: 使用专用测试环境
3. **监控准备**: 启动系统监控工具
4. **通知相关人员**: 避免干扰生产环境

### 测试执行注意
1. **逐步加压**: 不要一次性达到最大负载
2. **观察指标**: 实时关注系统资源使用
3. **及时停止**: 发现严重问题立即停止测试
4. **记录问题**: 详细记录异常情况

### 结果验证
1. **数据一致性**: 验证测试后数据完整性
2. **日志检查**: 检查系统错误日志
3. **性能对比**: 与基准数据对比分析
4. **问题归类**: 区分性能问题和功能问题

---

**文档维护**: 测试工程师  
**创建日期**: 2025年1月3日  
**适用版本**: BZK查询系统 v2.0+  
**下一步**: 执行功能自动化测试脚本编写 